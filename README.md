API приложение для поиска, продажи и покупки товаров.

Имеет следующий функционал:

* Регистрация пользователя с подтверждением почты.
* Авторизация и аутентификация пользователей.
* Изменение пароля через электронную почту.
* CRUD для объявлений на сайте (админ может удалять или редактировать все объявления, а пользователи только свои).
* Под каждым объявлением пользователи могут оставлять отзывы.
* CRUD для отзывов (админ может удалять или редактировать все отзывы, а пользователи только свои).
* В заголовке сайта можно осуществлять поиск объявлений по названию, а также отзывов.
* Добавление товара в корзину и удаление из нее.
* Создание заказа всего содержимого в корзине и оплата его на сайте STRIPE
* Проверка дней рождений у пользователей и автоматическая отправка сообщений с поздравлениями на email
* Автоматическая рассылка пользователям раз в неделю сообщений с акциями
* REDOC для взаимодействия с другими сервисами

В проекте используются следующие зависимости:

* django
* djangorestframework
* djangorestframework-simplejwt
* django-cors-headers
* drf-yasg
* psycopg2-binary
* python-dotenv
* pillow
* django-filter
* docker
* pytest
* pytest-django
* pytest-cov
* stripe
* celery
* django-celery-beat
* redis

Для разработки дополнительно:
* flake8
* ipython
* black
* isort

Для начала работы:

1. Скачать репозиторий.
2. Применить все зависимости с файла [requirements.txt](requirements.txt) 
   
    (**команда: pip install -r requirements.txt**).
3. Создать файл _.env_ и внести все чувствительные параметры указанные в файле [.env.sample](.env.sample)
4. Для заполнения базы данных применить подготовленные фикстуры [announcements.json](announcements/fixtures/announcements.json), [baskets.json](baskets/fixtures/baskets.json), [orders.json](orders/fixtures/orders.json), [users.json](users/fixtures/users.json) 

    (**команда: python3 manage.py loaddata users.json announcements.json baskets.json orders.json**)

    Если нужна пустая база данных с суперпользователем, то выполните команду csu 

    (**команда: python3 manage.py csu**) 
5. Для работы celery запустите redis сервер 

    (**команда: redis-server**) и далее (**команда: celery -A config worker --beat --scheduler django --loglevel=info**)
6. Если есть надобность задеплоить проект на Docker 

    (**команда: docker-compose up -d --build**)

Имеются тесты на весь функционал проекта с покрытием в 96%

**Создание пользователя**
При создании пользователя имеется валидация на уникальный электронный адрес который используется как логин, и на минимальную длину пароля. 
Если данные введены корректно, то на указанный электронный адрес отправляется сообщение со ссылкой для активации, передя по которой, почта подтверждается и пользователь становится активным. Подтверждение происходит путем присваивания токена в момент создания пользователя, который и является частью ссылки. 

**Восстановления пароля**
Восстановление пароля происходит путем внесения электронной почты в соответствующем эндпоинте. В сообщении указаны параметры uid и token которые нужно ввести в соответствующие поля в эндпоинте и указать новый пароль. Если вся информация валидна, то выходит сообщение «Пароль успешно изменен!» При этом если пользователь попробует с помощью этих же параметров изменить пароль еще раз, то у него не получится, так как в момент успешного изменения, у него автоматически меняется token и чтобы ему опять изменить пароль нужно делать запрос заново. 

**Создание товара**
При создании товара имеется валидация на запрещенные слова в заголовке и в описании товара и проверка суммы на нулевое значение. В случае корректных введенных данных, создается объект с автоматическим присваиванием автора. 

**Создание отзыва**
При создании отзыва также имеется валидация на запрещенные слова в тексте, если поля заполнены корректно, то создается объект с привязкой к товару и к автору. 

**Отображение комментариев**
При выводе списка товаров указывается количество комментариев к товару, а в случае просмотра товара выводятся сами комментарии

**Добавление в корзину**
Добавление в корзину происходит путем отправки POST запроса с ключом товара в соответствующем эндпоинте. В корзине может быть добавлено неограниченное количество товаров.

**Удаление из корзины**
Удаление из корзины происходить через тот же эндпоинт что и добавление в корзину, путем отправки POST запроса с ключом товара находящегося в корзине. 

**Создание заказа**
Заказ создается на основании корзины пользователя в соответствующем эндпоинте. В нем создается ссылка, с общей суммой корзины и создается ссылка для оплаты на платформе Stripe. 

**Периодические задачи**
Так же имеются две периодические задачи. Первая – ежедневная проверка на день рождение и отправка поздравления на электронную почту пользователя. Вторая - отправка раз в неделю рекламных текстов заранее подготовленных. 


Приятного использования. GromovAS.
